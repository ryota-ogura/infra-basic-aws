■プライベートサブネットとDBサーバーの構築
===

### プライベートサブネットの作成
1. VPCダッシュボードから「サブネット」を選択
  * 先ほど作った「[チーム名]-パブリックサブネット」がある事もついでに確認
2. サブネットの作成ウィザードを起動
3. プライベートサブネットの作成
  * 10.0.2.0/24 のCIDRを作成
  * ネームタグで「[チーム名]-プライベートサブネット」と命名

※VPC：10.0.0.0/16 において、10.0.3.0～10.0.255.255は未使用となる

### プライベートサブネットのルートテーブルを確認する
1. VPCダッシュボード -> 「サブネット」
2. 先ほど作った「[チーム名]-プライベートサブネット」を選択
3. 「ルートテーブル」タブを確認
  * 10.0.0.0/16 -> local の設定のみがあるデフォルトルートテーブルになっている事

※こちらのサブネットはインターネットへ接続しないためこのままの設定とする

### プライベートサブネットにインスタンスを作成する
※Webサーバーと基本手順は同じなので、異なる点のみ記載

1. 起動するサブネットを選択： **[チーム名]-プライベートサブネット** に設定。
2. 自動割り当てパブリック IP：無効化 ＃インターネットに繋がらないため
3. ネットワークインタフェース：デバイスeth0のプライマリIP に **「10.0.2.10」** を入力
  * プライベートサブネットのIP範囲のなら何でも良い。
4. インスタンス名をつける：**[チーム名]-DBサーバー** と命名
5. セキュリティグループを設定する：
  * 新しいセキュリティグループを作成
  * セキュリティグループ名：**[チーム名]-DB-SG** と命名
  * 「ルールの追加」
    * タイプ：**MYSQL/Aurora** を選択
    * 送信元：**任意の場所、0.0.0.0/0**

### WebサーバーからDBサーバーへpingで疎通確認する
1. EC2ダッシュボード->「セキュリティグループ」
2. 先ほど作成した「[チーム名]-DB-SG」を選択
3. 「インバウンド」タブで「編集」->「ルールの追加」
  * タイプ: **すべてのICMP**
  * 送信元：**任意の場所、0.0.0.0/0**
  * 「保存」をクリック

* WebサーバーへSSH接続
```bash:
ssh -i ~/.ssh/my-key.pem ec2-user@xx.xx.xx.xx
```

* pingコマンドをDBサーバー向けに実行
```bash:
ping 10.0.2.10
```
->応答 **「64 bytes from 10.0.2.10:...」** が返ること ※Ctrl+C で停止

### DBサーバーへSSH接続する
* 秘密鍵をWebサーバーへアップロードする
```bash:
scp -i ~/.ssh/my-key.pem ~/.ssh/my-key.pem ec2-user@xx.xx.xx.xx:~/.ssh/
```
Webサーバーの~/.ssh/へmy-key.pemを転送

* WebサーバーへSSH接続
```bash:
ssh -i ~/.ssh/my-key.pem ec2-user@xx.xx.xx.xx
```

* 先ほど転送した鍵のパーミッションを自分だけ読める権限に変更
```bash:
chmod 400 ~/.ssh/my-key.pem
```

* 鍵を使い更にDBサーバーへSSH接続する
```bash:
ssh -i ~/.ssh/my-key.pem ec2-user@10.0.2.10
```
